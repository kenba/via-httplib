<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="762px" preserveAspectRatio="none" style="width:502px;height:762px;background:#FFFFFF;" version="1.1" viewBox="0 0 502 762" width="502px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="81.0547" style="stroke:#000000;stroke-width:1.5;" width="335" x="10" y="141.4453"/><rect fill="none" height="396.7578" style="stroke:#000000;stroke-width:1.5;" width="472" x="23" y="236.5"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="70" x2="70" y1="82.6094" y2="92.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="70" x2="70" y1="92.6094" y2="134.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="70" x2="70" y1="134.4453" y2="680.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="171" x2="171" y1="82.6094" y2="92.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="171" x2="171" y1="92.6094" y2="134.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="171" x2="171" y1="134.4453" y2="680.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="279" x2="279" y1="82.6094" y2="92.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="279" x2="279" y1="92.6094" y2="134.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="279" x2="279" y1="134.4453" y2="680.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="435.5" x2="435.5" y1="82.6094" y2="92.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="435.5" x2="435.5" y1="92.6094" y2="134.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="435.5" x2="435.5" y1="134.4453" y2="680.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="20" y="79.5332">server or client</text><ellipse cx="70" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M70,21.5 L70,48.5 M57,29.5 L83,29.5 M70,48.5 L57,63.5 M70,48.5 L83,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="20" y="694.1426">server or client</text><ellipse cx="70" cy="705.7188" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M70,713.7188 L70,740.7188 M57,721.7188 L83,721.7188 M70,740.7188 L57,755.7188 M70,740.7188 L83,755.7188 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="130" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="137" y="71.5332">connection</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="130" y="679.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="137" y="701.1426">connection</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="223" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="230" y="71.5332">socket_adaptor</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="223" y="679.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="230" y="701.1426">socket_adaptor</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="393.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="400.5" y="71.5332">asio.socket</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="393.5" y="679.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="400.5" y="701.1426">asio.socket</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="230" x="138" y="118.0283">connection open for transmission and reception</text><path d="M10,141.4453 L71,141.4453 L71,149.7969 L61,159.7969 L10,159.7969 L10,141.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="81.0547" style="stroke:#000000;stroke-width:1.5;" width="335" x="10" y="141.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="155.9404">alt</text><polygon fill="#181818" points="159.5,178.1484,169.5,182.1484,159.5,186.1484,163.5,182.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="70" x2="165.5" y1="182.1484" y2="182.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="77" y="177.292">shutdown</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="345" y1="191.1484" y2="191.1484"/><polygon fill="#181818" points="182.5,210.5,172.5,214.5,182.5,218.5,178.5,214.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176.5" x2="278" y1="214.5" y2="214.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="188.5" y="209.6436">disconnect</text><path d="M23,236.5 L84,236.5 L84,244.8516 L74,254.8516 L23,254.8516 L23,236.5 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="396.7578" style="stroke:#000000;stroke-width:1.5;" width="472" x="23" y="236.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="38" y="250.9951">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="25" x="99" y="249.9189">[ssl]</text><polygon fill="#181818" points="267,273.2031,277,277.2031,267,281.2031,271,277.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="171.5" x2="273" y1="277.2031" y2="277.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="178.5" y="272.3467">shutdown</text><polygon fill="#181818" points="424,303.5547,434,307.5547,424,311.5547,428,307.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279" x2="430" y1="307.5547" y2="307.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="286" y="302.6982">async_shutdown</text><polygon fill="#181818" points="290,345.082,280,349.082,290,353.082,286,349.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="435" y1="349.082" y2="349.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="296" y="344.2256">ssl shutdown response</text><path d="M72,320.5547 L72,362.5547 L274,362.5547 L274,330.5547 L264,320.5547 L72,320.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M264,320.5547 L264,330.5547 L274,330.5547 L264,320.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="78" y="339.0498">The ssl socket_adaptor ignores</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="78" y="355.4014">the ssl shutdown response</text><polygon fill="#181818" points="424,397.7852,434,401.7852,424,405.7852,428,401.7852" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279" x2="430" y1="401.7852" y2="401.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="286" y="396.9287">async_write</text><path d="M33,373.2578 L33,415.2578 L274,415.2578 L274,383.2578 L264,373.2578 L33,373.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M264,373.2578 L264,383.2578 L274,383.2578 L264,373.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="39" y="391.7529">The write will fail with error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="39" y="408.1045">SSL_R_PROTOCOL_IS_SHUTDOWN</text><polygon fill="#181818" points="182.5,439.3125,172.5,443.3125,182.5,447.3125,178.5,443.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176.5" x2="435" y1="443.3125" y2="443.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="188.5" y="438.4561">write_callback</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="23" x2="495" y1="452.3125" y2="452.3125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="25" x="28" y="463.7314">[tcp]</text><polygon fill="#181818" points="267,485.5,277,489.5,267,493.5,271,489.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="171.5" x2="273" y1="489.5" y2="489.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="178.5" y="484.6436">shutdown</text><polygon fill="#181818" points="424,515.8516,434,519.8516,424,523.8516,428,519.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279" x2="430" y1="519.8516" y2="519.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="286" y="514.9951">shutdown</text><polygon fill="#181818" points="290,557.3789,280,561.3789,290,565.3789,286,561.3789" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="435" y1="561.3789" y2="561.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="296" y="556.5225">disconnected</text><path d="M70,532.8516 L70,574.8516 L274,574.8516 L274,542.8516 L264,532.8516 L70,532.8516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M264,532.8516 L264,542.8516 L274,542.8516 L264,532.8516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="76" y="551.3467">The tcp socket_adaptor waits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="76" y="567.6982">for the tcp socket to disconnect</text><polygon fill="#181818" points="182.5,610.082,172.5,614.082,182.5,618.082,178.5,614.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176.5" x2="278" y1="614.082" y2="614.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="188.5" y="609.2256">write_callback</text><path d="M284,585.5547 L284,627.5547 L480,627.5547 L480,595.5547 L470,585.5547 L284,585.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M470,585.5547 L470,595.5547 L480,595.5547 L470,585.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="290" y="604.0498">The tcp socket_adaptor sends</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="290" y="620.4014">eof to signal disconnected</text><polygon fill="#181818" points="81,658.6094,71,662.6094,81,666.6094,77,662.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="75" x2="170.5" y1="662.6094" y2="662.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="87" y="657.7529">disconnected</text><!--MD5=[459d87341870bc0a01f74c39d6134cd1]
@startuml

'Copyright (c) 2013-2024 Ken Barker

' title Socket Disonnection Sequence

'autonumber
actor "server or client"

... connection open for transmission and reception ...

alt 
"server or client" -> connection : shutdown
else
connection <- socket_adaptor: disconnect
end alt

alt ssl
connection -> socket_adaptor : shutdown
socket_adaptor -> asio.socket : async_shutdown
socket_adaptor <- asio.socket : ssl shutdown response
note left
The ssl socket_adaptor ignores
the ssl shutdown response
end note
socket_adaptor -> asio.socket : async_write
note left
The write will fail with error
SSL_R_PROTOCOL_IS_SHUTDOWN
end note
connection <- asio.socket : write_callback
else tcp
connection -> socket_adaptor : shutdown
socket_adaptor -> asio.socket : shutdown
socket_adaptor <- asio.socket : disconnected
note left
The tcp socket_adaptor waits
for the tcp socket to disconnect
end note
connection <- socket_adaptor : write_callback
note right
The tcp socket_adaptor sends
eof to signal disconnected
end note
end alt

"server or client" <- connection : disconnected

@enduml

@startuml



actor "server or client"

... connection open for transmission and reception ...

alt 
"server or client" -> connection : shutdown
else
connection <- socket_adaptor: disconnect
end alt

alt ssl
connection -> socket_adaptor : shutdown
socket_adaptor -> asio.socket : async_shutdown
socket_adaptor <- asio.socket : ssl shutdown response
note left
The ssl socket_adaptor ignores
the ssl shutdown response
end note
socket_adaptor -> asio.socket : async_write
note left
The write will fail with error
SSL_R_PROTOCOL_IS_SHUTDOWN
end note
connection <- asio.socket : write_callback
else tcp
connection -> socket_adaptor : shutdown
socket_adaptor -> asio.socket : shutdown
socket_adaptor <- asio.socket : disconnected
note left
The tcp socket_adaptor waits
for the tcp socket to disconnect
end note
connection <- socket_adaptor : write_callback
note right
The tcp socket_adaptor sends
eof to signal disconnected
end note
end alt

"server or client" <- connection : disconnected

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>